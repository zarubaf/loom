# SPDX-License-Identifier: Apache-2.0
TOP      := axil_completeness
DUT_SRC  := axil_completeness.sv

include ../../src/util/mk/loom_test.mk

# Override test target â€” exercise every address region
test: $(_TEST_DEPS)
	$(LOOMX) -work $(BUILD) -sim Vloom_shell -timeout -1 \
		-f $(CURDIR)/test_script.txt 2>&1 | tee $(BUILD)/test.log
	@echo "--- Checking AXI-Lite completeness ---"
	@# Valid emu_ctrl registers must return real data (not 0xdeadbeef)
	@if grep -c '0x[0-9a-f]\{8\}' $(BUILD)/test.log > /dev/null; then true; fi
	@# Unmapped shell demux reads must complete (not hang)
	@grep -q '\[.*\] read 0x60000' $(BUILD)/test.log
	@grep -q '\[.*\] read 0xffffc' $(BUILD)/test.log
	@# Unmapped emu_top demux hole reads must complete
	@grep -q '\[.*\] read 0x30000' $(BUILD)/test.log
	@grep -q '\[.*\] read 0x3fffc' $(BUILD)/test.log
	@# Unmapped writes must complete
	@grep -q '\[.*\] write 0x60000' $(BUILD)/test.log
	@grep -q '\[.*\] write 0x30000' $(BUILD)/test.log
	@# Must reach exit (all transactions completed)
	@grep -q '\[.*\] exit' $(BUILD)/test.log
	@echo "PASS: all AXI-Lite transactions completed (no hangs)"
