# SPDX-License-Identifier: Apache-2.0
# scan_basic test - Basic scan chain insertion test
# Tests that scan_insert pass runs without errors on a simple design

# Read the test design
read_slang ../fixtures/tiny_dff.sv

# Elaborate and optimize
hierarchy -top tiny_dff
proc
opt_clean

# Show design before scan insertion
log "=== Before scan insertion ==="
stat

# Run scan insertion
scan_insert

# Show design after scan insertion
log "=== After scan insertion ==="
stat

# Verify loom_scan_* ports were added (non-escaped naming)
select -assert-count 1 w:loom_scan_enable
select -assert-count 1 w:loom_scan_in
select -assert-count 1 w:loom_scan_out

# Verify design is still valid
check -assert

# Write output for inspection
write_verilog scan_basic_output.v
